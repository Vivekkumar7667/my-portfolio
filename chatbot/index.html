<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aaisa AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Dark Theme (Default) */
        .dark {
            --bg-body: url('https://images.pexels.com/photos/38136/pexels-photo-38136.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');
            --bg-primary: rgba(17, 24, 39, 0.7); /* gray-900/70 */
            --bg-secondary: rgba(57, 85, 124, 0.8); /* gray-800/80 */
            --bg-tertiary: rgba(55, 65, 81, 0.9); /* gray-700/90 */
            --text-primary: #f9fafb; /* gray-50 */
            --text-secondary: #d1d5db; /* gray-300 */
            --border-color: rgba(55, 65, 81, 0.5);
        }

        /* Light Theme */
        .light {
            --bg-body: url('https://images.pexels.com/photos/1420440/pexels-photo-1420440.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');
            --bg-primary: rgba(249, 250, 251, 0.8); /* gray-50/80 */
            --bg-secondary: rgba(255, 255, 255, 0.9); /* white/90 */
            --bg-tertiary: #f3f4f6; /* gray-100 */
            --text-primary: #111827; /* gray-900 */
            --text-secondary: #4b5563; /* gray-600 */
            --border-color: rgba(209, 213, 219, 0.5);
        }
        
        body {
            background-image: var(--bg-body);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .chat-container::-webkit-scrollbar, .sidebar-scroll::-webkit-scrollbar { width: 6px; }
        .chat-container::-webkit-scrollbar-thumb, .sidebar-scroll::-webkit-scrollbar-thumb { background-color: #9ca3af; border-radius: 3px; }
        .chat-container::-webkit-scrollbar-track, .sidebar-scroll::-webkit-scrollbar-track { background-color: rgba(0,0,0,0.1); }
        .loader { width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .mic-listening { color: #ef4444; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
        }
        
        const languages = [ { code: 'en-US', name: 'English' }, { code: 'hi-IN', name: 'हिन्दी' }];
        const placeholders = { 'en-US': 'Type or speak your message...', 'hi-IN': 'अपना संदेश टाइप करें या बोलें...', 'es-ES': 'Escribe o di tu mensaje...', 'fr-FR': 'Tapez ou parlez votre message...', 'de-DE': 'Geben Sie Ihre Nachricht ein oder sprechen Sie...' };
        
        const AiIcon = () => ( <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="text-cyan-400"> <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2z" stroke="currentColor" strokeWidth="1.5" strokeOpacity="0.5"/> <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0-8 0" fill="currentColor" fillOpacity="0.5"/> <path d="M12 12m-2 0a2 2 0 1 0 4 0a2 2 0 1 0-4 0" fill="currentColor"/> <path d="M12 4.5V6" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/> <path d="M12 18v1.5" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/> <path d="M19.5 12H18" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/> <path d="M6 12H4.5" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/> </svg> );

        const SettingsModal = ({ isOpen, onClose, settings, updateSettings }) => {
            if (!isOpen) return null;

            const handleClearChat = () => {
                if(confirm("Are you sure you want to clear this conversation? This action cannot be undone.")){
                    updateSettings('clearChat');
                    onClose();
                }
            };

            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
                    <div className="w-full max-w-md rounded-lg shadow-lg" style={{backgroundColor: 'var(--bg-secondary)'}}>
                        <div className="p-4 border-b flex justify-between items-center" style={{borderColor: 'var(--border-color)'}}>
                            <h2 className="text-lg font-semibold" style={{color: 'var(--text-primary)'}}>Settings</h2>
                            <button onClick={onClose} className="p-2 rounded-full hover:bg-gray-700/50" style={{color: 'var(--text-secondary)'}}><i className="fas fa-times"></i></button>
                        </div>
                        <div className="p-6 space-y-6">
                            {/* Theme Toggle */}
                            <div className="flex justify-between items-center">
                                <label htmlFor="theme-toggle" className="text-sm font-medium" style={{color: 'var(--text-primary)'}}>Theme</label>
                                <div className="flex items-center gap-2">
                                    <span className="text-sm" style={{color: 'var(--text-secondary)'}}>Light</span>
                                    <button onClick={() => updateSettings('theme', settings.theme === 'dark' ? 'light' : 'dark')} className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${settings.theme === 'dark' ? 'bg-blue-600' : 'bg-gray-400'}`}>
                                        <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${settings.theme === 'dark' ? 'translate-x-6' : 'translate-x-1'}`} />
                                    </button>
                                    <span className="text-sm" style={{color: 'var(--text-secondary)'}}>Dark</span>
                                </div>
                            </div>
                            {/* Speech Output Toggle */}
                            <div className="flex justify-between items-center">
                                <label htmlFor="speech-toggle" className="text-sm font-medium" style={{color: 'var(--text-primary)'}}>Speech Output</label>
                                <button onClick={() => updateSettings('speech', !settings.isSpeechEnabled)} className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${settings.isSpeechEnabled ? 'bg-blue-600' : 'bg-gray-400'}`}>
                                    <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${settings.isSpeechEnabled ? 'translate-x-6' : 'translate-x-1'}`} />
                                </button>
                            </div>
                             {/* Clear Conversation */}
                            <div className="flex justify-between items-center pt-4 border-t" style={{borderColor: 'var(--border-color)'}}>
                                <span className="text-sm font-medium" style={{color: 'var(--text-primary)'}}>Clear Conversation</span>
                                <button onClick={handleClearChat} className="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2" style={{'--tw-ring-offset-color': 'var(--bg-secondary)'}}>Clear</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [messages, setMessages] = useState([ { text: "Hello! I'm Aaisa AI. Select a language and start chatting. How can I help you today?", sender: 'ai' } ]);
            const [inputValue, setInputValue] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const [isLangMenuOpen, setIsLangMenuOpen] = useState(false);
            const [isListening, setIsListening] = useState(false);
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);
            const [selectedImage, setSelectedImage] = useState(null);
            const [language, setLanguage] = useState('en-US');
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [settings, setSettings] = useState({
                theme: 'dark',
                isSpeechEnabled: true,
            });
            
            const chatContainerRef = useRef(null);
            const menuRef = useRef(null);
            const langMenuRef = useRef(null);
            const fileInputRef = useRef(null);

            useEffect(() => {
                document.documentElement.className = settings.theme;
            }, [settings.theme]);

            const updateSettings = (key, value) => {
                if (key === 'clearChat') {
                    setMessages([{ text: "Conversation cleared. How can I help you now?", sender: 'ai' }]);
                } else {
                    setSettings(prev => ({ ...prev, [key]: value }));
                }
            };
            
            const speakText = (text) => {
                if (!settings.isSpeechEnabled || !('speechSynthesis' in window)) return;
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = language;
                const voices = speechSynthesis.getVoices();
                let selectedVoice = voices.find(v => v.lang === language && v.gender === 'female') || voices.find(v => v.lang === language);
                utterance.voice = selectedVoice || voices.find(v => v.lang.startsWith(language.split('-')[0])) || voices[0];
                speechSynthesis.cancel();
                speechSynthesis.speak(utterance);
            };

            useEffect(() => {
                if ('speechSynthesis' in window) speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
                if (chatContainerRef.current) chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;
            }, [messages]);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (menuRef.current && !menuRef.current.contains(event.target)) setIsMenuOpen(false);
                    if (langMenuRef.current && !langMenuRef.current.contains(event.target)) setIsLangMenuOpen(false);
                };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            useEffect(() => {
                if (!recognition) return;
                recognition.lang = language;
                recognition.onresult = (event) => { setInputValue(event.results[0][0].transcript); setIsListening(false); };
                recognition.onerror = (event) => { console.error("Speech recognition error:", event.error); setIsListening(false); };
                recognition.onend = () => setIsListening(false);
            }, [language]);

            const handleImageUpload = (event) => {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onloadend = () => setSelectedImage({ dataUrl: reader.result, mimeType: file.type });
                    reader.readAsDataURL(file);
                }
            };

            const handleSendMessage = async () => {
                const text = inputValue.trim();
                if ((text === '' && !selectedImage) || isLoading) return;

                const userMessage = { text, sender: 'user', image: selectedImage ? selectedImage.dataUrl : null };
                setMessages(prev => [...prev, userMessage]);
                setInputValue('');
                setIsLoading(true);

                try {

                    const parts = [];
                    if (text) parts.push({ text: `Please respond in the same language as this query: "${text}"` });
                    if (selectedImage) {
                        const base64Data = selectedImage.dataUrl.split(',')[1];
                        parts.push({ inlineData: { mimeType: selectedImage.mimeType, data: base64Data } });
                        if(!text) parts.push({text: `What is in this image? Respond in ${languages.find(l => l.code === language).name}.`});
                    }

                    const payload = { contents: [{ role: "user", parts: parts }] };
                    const apiKey = "AIzaSyD5kA-JQcE2pYooqpAD58JLBpa7FTs1_Bc";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error(`API error: ${response.statusText}`);
                    const result = await response.json();
                    
                    let aiText = "Sorry, I couldn't get a response. Please try again.";
                    if (result.candidates && result.candidates[0]?.content?.parts?.[0]) aiText = result.candidates[0].content.parts[0].text;

                    const aiMessage = { text: aiText, sender: 'ai' };
                    setMessages(prev => [...prev, aiMessage]);
                    speakText(aiText);

                } catch (error) {
                    console.error("Failed to fetch AI response:", error);
                    const errorMessage = { text: `Error: ${error.message}.`, sender: 'ai', isError: true };
                    setMessages(prev => [...prev, errorMessage]);
                } finally {
                    setIsLoading(false);
                    setSelectedImage(null);
                    if(fileInputRef.current) fileInputRef.current.value = "";
                }
            };

            const handleKeyPress = (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSendMessage(); } };
            const toggleListen = () => { if (!recognition) return; if (isListening) recognition.stop(); else recognition.start(); setIsListening(!isListening); };

            return (
                <div className="flex h-screen" style={{color: 'var(--text-primary)'}}>
                    <SettingsModal isOpen={isSettingsOpen} onClose={() => setIsSettingsOpen(false)} settings={settings} updateSettings={updateSettings} />
                    <div className={`flex flex-col backdrop-blur-sm transition-all duration-300 ${isSidebarOpen ? 'w-64' : 'w-0'} overflow-hidden`} style={{backgroundColor: 'var(--bg-primary)'}}>
                        <div className="p-4 flex justify-between items-center border-b" style={{borderColor: 'var(--border-color)'}}><h2 className="text-lg font-semibold">History</h2></div>
                        <div className="p-2"><button className="w-full text-left p-2 rounded-md hover:bg-gray-700/80 flex items-center gap-2"><i className="fas fa-plus"></i>New Chat</button></div>
                        <div className="flex-1 p-2 space-y-2 overflow-y-auto sidebar-scroll">
                            <div className="p-2 rounded-md hover:bg-gray-700/80 cursor-pointer text-sm truncate">What is the capital of France?</div>
                            <div className="p-2 rounded-md hover:bg-gray-700/80 cursor-pointer text-sm truncate">How to make a React app</div>
                            <div className="p-2 rounded-md bg-gray-700/90 cursor-pointer text-sm truncate">Nature background ideas</div>
                        </div>
                    </div>

                    <div className="flex flex-col flex-1 bg-black/10">
                        <header className="shadow-md p-4 flex items-center justify-between backdrop-blur-sm border-b" style={{backgroundColor: 'var(--bg-primary)', borderColor: 'var(--border-color)'}}>
                            <div className="flex items-center">
                                <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="mr-2 p-2" style={{color: 'var(--text-secondary)'}}><i className="fas fa-bars text-xl"></i></button>
                                <div className="mr-3"><AiIcon /></div>
                                <h1 className="text-xl font-semibold">Aaisa AI</h1>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="relative" ref={langMenuRef}>
                                    <button onClick={() => setIsLangMenuOpen(!isLangMenuOpen)} className="p-2" style={{color: 'var(--text-secondary)'}}><i className="fas fa-globe text-xl"></i></button>
                                    {isLangMenuOpen && ( <div className="absolute right-0 mt-2 w-40 rounded-md shadow-lg py-1 z-50" style={{backgroundColor: 'var(--bg-secondary)'}}> {languages.map(lang => ( <a key={lang.code} href="#" onClick={(e) => { e.preventDefault(); setLanguage(lang.code); setIsLangMenuOpen(false); }} className={`block px-4 py-2 text-sm ${language === lang.code ? 'bg-blue-600 text-white' : 'hover:bg-gray-700/80'}`} style={{color: language !== lang.code ? 'var(--text-primary)' : 'white'}}>{lang.name}</a> ))} </div> )}
                                </div>
                                <div className="relative" ref={menuRef}>
                                    <button onClick={() => setIsMenuOpen(!isMenuOpen)} className="p-2" style={{color: 'var(--text-secondary)'}}><i className="fas fa-ellipsis-v text-xl"></i></button>
                                    {isMenuOpen && ( <div className="absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 z-50" style={{backgroundColor: 'var(--bg-secondary)'}}> <a href="#" onClick={(e) => { e.preventDefault(); setIsSettingsOpen(true); setIsMenuOpen(false); }} className="block px-4 py-2 text-sm hover:bg-gray-700/80" style={{color: 'var(--text-primary)'}}>Settings</a> <a href="#" className="block px-4 py-2 text-sm hover:bg-gray-700/80" style={{color: 'var(--text-primary)'}}>About</a> <a href="#" className="block px-4 py-2 text-sm hover:bg-gray-700/80" style={{color: 'var(--text-primary)'}}>Themes</a> <a href="#" className="block px-4 py-2 text-sm hover:bg-gray-700/80" style={{color: 'var(--text-primary)'}}>Login</a> </div> )}
                                </div>
                            </div>
                        </header>

                        <main ref={chatContainerRef} className="flex-1 p-4 sm:p-6 overflow-y-auto chat-container">
                            <div className="space-y-4">
                                {messages.map((msg, index) => (
                                    <div key={index} className={`flex items-end gap-2 ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        {msg.sender === 'ai' && (<button onClick={() => speakText(msg.text)} className="mb-2" style={{color: 'var(--text-secondary)'}}><i className="fas fa-volume-up"></i></button>)}
                                        <div className={`max-w-xs lg:max-w-xl px-4 py-3 rounded-2xl shadow-lg ${msg.sender === 'user' ? 'bg-blue-600 text-white rounded-br-none' : msg.isError ? 'bg-red-700 text-white rounded-bl-none' : 'rounded-bl-none'}`} style={{backgroundColor: msg.sender === 'ai' && !msg.isError ? 'var(--bg-tertiary)' : '', color: msg.sender==='ai' ? 'var(--text-primary)' : 'white'}}>
                                            {msg.image && <img src={msg.image} alt="Upload preview" className="rounded-lg mb-2 max-h-48"/>}
                                            <p className="text-sm" style={{whiteSpace: 'pre-wrap'}}>{msg.text}</p>
                                        </div>
                                    </div>
                                ))}
                                {isLoading && ( <div className="flex justify-start"><div className="rounded-2xl rounded-bl-none px-4 py-3 flex items-center space-x-2 shadow-lg" style={{backgroundColor: 'var(--bg-tertiary)'}}><div className="loader"></div><span className="text-sm">AI is thinking...</span></div></div> )}
                            </div>
                        </main>

                        <footer className="p-4 sm:p-6 border-t backdrop-blur-sm" style={{backgroundColor: 'var(--bg-primary)', borderColor: 'var(--border-color)'}}>
                            <div className="max-w-4xl mx-auto">
                                {selectedImage && ( <div className="mb-2 p-2 rounded-lg flex items-center justify-between" style={{backgroundColor: 'var(--bg-secondary)'}}> <div className="flex items-center gap-2"><img src={selectedImage.dataUrl} className="h-12 w-12 object-cover rounded"/><span className="text-sm" style={{color: 'var(--text-secondary)'}}>Image selected</span></div> <button onClick={() => {setSelectedImage(null); if(fileInputRef.current) fileInputRef.current.value = "";}} style={{color: 'var(--text-secondary)'}}><i className="fas fa-times"></i></button> </div> )}
                                <div className="flex items-center rounded-xl p-2 shadow-lg" style={{backgroundColor: 'var(--bg-secondary)'}}>
                                    <input type="file" accept="image/*" ref={fileInputRef} onChange={handleImageUpload} className="hidden"/>
                                    <button onClick={() => fileInputRef.current.click()} className="p-2" style={{color: 'var(--text-secondary)'}}><i className="fas fa-paperclip"></i></button>
                                    <textarea value={inputValue} onChange={(e) => setInputValue(e.target.value)} onKeyPress={handleKeyPress} placeholder={placeholders[language]} rows="1" className="flex-1 bg-transparent focus:outline-none resize-none px-2" style={{color: 'var(--text-primary)'}} />
                                    {SpeechRecognition && (<button onClick={toggleListen} className={`p-2 rounded-full transition-colors ${isListening ? 'mic-listening' : ''}`} style={{color: 'var(--text-secondary)'}}><i className="fas fa-microphone"></i></button>)}
                                    <button onClick={handleSendMessage} disabled={isLoading || (!inputValue.trim() && !selectedImage)} className={`ml-2 p-2 rounded-full transition-colors ${(isLoading || (!inputValue.trim() && !selectedImage)) ? 'bg-gray-600 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'}`}> <i className="fas fa-paper-plane text-white"></i> </button>
                                </div>
                            </div>
                        </footer>
                    </div>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
